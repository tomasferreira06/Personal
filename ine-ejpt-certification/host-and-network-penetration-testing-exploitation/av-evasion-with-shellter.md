---
description: https://www.shellterproject.com/
---

# AV Evasion With Shellter

Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise. Techniques used for defense evasion include unisntalling/disabling security software or obfuscating/Encrypting data and scripts. Adversaries also leverage and abuse trusted processes to hide and masquerade their malware. - MITRE

## AV Detection Methods

AV software will typically utilize signature, heuristic and behaviour based detection.

1. <mark style="color:red;">**Signature based detection**</mark> - An AV signature is a unique sequence of bytes that uniquely identifies malware. As a result, you will have to ensure that your obfusctaed exploit or payload doesn't match any known signature in the AV database.

We can by pass signature-based detection by modifying the malware's byte sequece, therefore changing the signature.

2. <mark style="color:red;">**Heuristic-based detection**</mark> - Relies on rules or decisions to determine whether a binary is malicious. It also looks for specific patterns within the code or program calls.
3. <mark style="color:red;">**Behaviour based detection**</mark> - Relies on identifying malware by monitoring it's behaviour. (Used for newer strains of malware).

**In-Memory Evasion Techniques**

* Focuses on manipulation of memory and does not write files to disk.
* Injects payload into a process by leveraging various Windows APIs.
* Payload is then exectued in memory in a separate thread.

## Practice Demo

You can install Shellter on Kali, it comes in the repositories.

* <mark style="color:yellow;">sudo apt-get install shellter -y</mark>

Since Shellter is really a Windows executable you need to install Wine

It allows to execute windows executables on UNIX and MAC.

We need to configure the Debian package management utility to install 32-bit packages.

* <mark style="color:yellow;">dpkg --add-architecture i386</mark>
* <mark style="color:yellow;">sudo apt-get install wine32</mark>

Now we can execute the shellter executable

Go to <mark style="color:red;">/usr/share/windows-resources/shellter</mark>

* <mark style="color:yellow;">sudo wine shellter.exe</mark>

### Injecting the payload into an executable

#### In this case we will use the "vncviewer.exe" to inject the payload to

A backup of the original "vncviewer.exe" will be created in the <mark style="color:red;">/usr/share/windows-resources/Shellter\_Backups</mark> directory.

Choose Operation Mode: <mark style="color:red;">A</mark> (for automatic)

PE Target: <mark style="color:yellow;">´´Path to executable to inject to´</mark>

#### Enabling Stealth Mode

Stealth mode makes it so that the original executable,  in this

case "vncviewer" maintains its original  functionality.

#### Choose the payload to use

You can specify a custom payload, like a msfvenom payload.





