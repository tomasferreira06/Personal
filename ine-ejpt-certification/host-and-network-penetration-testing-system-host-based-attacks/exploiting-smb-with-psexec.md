# Exploiting SMB With PsExec

<figure><img src="../../.gitbook/assets/image (58).png" alt=""><figcaption></figcaption></figure>

## PSExec

* PsExec is a lightweight telnet-replacement developed by Microsoft that allows you execute processes on remote windows systems using any userâ€™s credentials.&#x20;
* PsExec authentication is performed via SMB.&#x20;
* We can use the PsExec utility to authenticate with the target system legitimately and run arbitrary commands or launch a remote command prompt.&#x20;
* It is very similar to RDP, however, instead of controlling the remote system via GUI, commands are sent via CMD.

## SMB Exploitation with PSExec

* In order to utilize PsExec to gain access to a Windows target, we will need to identify legitimate user accounts and their respective passwords or password hashes.&#x20;
* This can be done by leveraging various tools and techniques, however, the most common technique will involve performing an SMB login brute-force attack.&#x20;
* We can narrow down our brute-force attack to only include common Windows user accounts like:
  * <mark style="color:red;">Administrator</mark>&#x20;
* After we have obtained a legitimate user account and password, we can use the credentials to authenticate with the target system via PsExec and execute arbitrary system commands or obtain a reverse shell.

## Practice Demo

#### Enumerate the target

If "<mark style="color:red;">message signing is enabled but not required</mark>" we can authenticate via PSExec.

### Performing SMB Brute-Force

Start msfconsole and postgresql.

Modules used:

* "<mark style="color:yellow;">auxiliary/scanner/smb/smb\_login</mark>"

Configure  RHOST

Specify "<mark style="color:red;">USER\_FILE</mark>" and "<mark style="color:red;">PASS\_FILE</mark>".

After getting the credentials getting a command prompt using PSExec:

* "<mark style="color:yellow;">psexec.py Administrator@targetIP cmd.exe</mark>"

### Metasploit Module

"<mark style="color:red;">exploit/windows/smb/psexec</mark>"

Authenticates using SMB and uploads a payload that gives us a meterpreter session on the target sytem.

Use module

Set RHOSTS

Set credentials obtained in "<mark style="color:red;">SMBUser</mark>" and "<mark style="color:red;">SMBPass</mark>"

Set the  payload options.
