# Exploiting Misconfigured Cron Jobs

## Cron Jobs

* Linux implements task scheduling through a utility called <mark style="color:red;">Cron</mark>.
* Cron is a time-based service that runs applications, scripts and other commands repeatedly on a specified schedule.
* An application, or script that has been configured to be run repeatedly with Cron is known as a Cron job. Cron can be used to automate or repeat a wide variety of functions on a system, from daily bakcups  to system upgrades and patches.
* The crontab file is a configuration file that is used by the Cron utility to store and track Cron jobs that have been created.

## Exploiting Misconfigured Cron Jobs

* Cron jobs can also be run as any user on the system, this is a very important factor to keep an eye on as we will be targeting Cron jobs that have been configured to be run as the "root" user.
* This is primarily because, any script or command that is run by a Cron job will run as the root user and will consquently provide us with root access.
* In order to elevate our privileges, we will need to find and identify cron jobs schedules by the  root user or the files being processed by the cron job.

## Practice Demo

In this case we have initial access to a unprivileged user account.

To identify cron jobs for the current user run:

* <mark style="color:yellow;">crontab -l</mark>

In this scenario there is a file called "message" in the user "student" home directory. It is owned by root.

To know if this file is being used for some cron job we can search for the path using grep recursively:

* <mark style="color:yellow;">grep -rnw /usr -e /home/student/message</mark>

<mark style="color:purple;">NOTE:</mark> Another way to find if the file exists on another place in the target is&#x20;

```
find / -name message
```

The script in <mark style="color:red;">/usr/local/share</mark> named <mark style="color:red;">copy.sh</mark> is copying the file in our home directory to the <mark style="color:red;">/tmp</mark> directory.

<figure><img src="../../.gitbook/assets/image (195).png" alt=""><figcaption></figcaption></figure>

By <mark style="color:red;">cat</mark> the files content in /tmp directory we can see it.

<figure><img src="../../.gitbook/assets/image (196).png" alt=""><figcaption></figcaption></figure>

The script being run by the root user to execute this is misconfigured, giving us all permissions we need.

<figure><img src="../../.gitbook/assets/image (197).png" alt=""><figcaption></figcaption></figure>

As we can see the reason we were able to cat the contents of the <mark style="color:red;">message</mark> file even though it is owned by root is because the script <mark style="color:red;">copy.sh</mark> after saving the file to the /tmp directory changes the permissions to the following:

<figure><img src="../../.gitbook/assets/image (198).png" alt=""><figcaption></figcaption></figure>

Since we have no text editors in the lab, to modify we will do the following:

* <mark style="color:yellow;">printf '#!/bin/bash\necho "student ALL=NOPASSWD:ALL" >> /etc/sudoers' > /usr/local/share/copy.sh</mark>

This command creates a Bash script that modifies the `sudoers` file to give the `student` user passwordless `sudo` privileges. Here's the step-by-step breakdown:

<mark style="color:yellow;">**`printf '#!/bin/bash\necho "student ALL=NOPASSWD:ALL" >> /etc/sudoers'`**</mark>:\
This uses <mark style="color:yellow;">`printf`</mark> to format a script. The content of the script is:

* <mark style="color:yellow;">`#!/bin/bash`</mark>: This is the "shebang," which tells the system that this is a Bash script.
* <mark style="color:yellow;">`echo "student ALL=NOPASSWD:ALL" >> /etc/sudoers`</mark>: This command appends the line <mark style="color:yellow;">`student ALL=NOPASSWD:ALL`</mark> to the <mark style="color:yellow;">`/etc/sudoers`</mark> file, giving the `student` user the ability to run any command as <mark style="color:yellow;">`sudo`</mark> without needing a password.

<mark style="color:yellow;">**`> /usr/local/share/copy.sh`**</mark>:\
This part saves the formatted script to a file called <mark style="color:red;">`copy.sh`</mark> located in the <mark style="color:red;">`/usr/local/share/`</mark> directory.
